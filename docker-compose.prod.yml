# Production overrides for docker-compose.yml
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  user:
    environment:
      NODE_ENV: production

  chat:
    environment:
      NODE_ENV: production

  notification:
    environment:
      NODE_ENV: production

  frontend:
    environment:
      NODE_ENV: production
      ORIGIN: https://chat.ctaprojects.xyz
      # Runtime environment variables for SvelteKit's $env/dynamic/public
      # These are read at runtime by the SvelteKit server and injected into client JS
      PUBLIC_API_URL: https://chat.ctaprojects.xyz
      PUBLIC_WS_URL: https://chat.ctaprojects.xyz
    build:
      context: ../chat-microservices-frontend
      args:
        # Build-time args (fallback for static imports)
        PUBLIC_API_URL: https://chat.ctaprojects.xyz
        PUBLIC_WS_URL: https://chat.ctaprojects.xyz

  # Production nginx with SSL certificate volumes
  nginx:
    volumes:
      # Let's Encrypt certificates and ACME challenge files
      # These are generated by init-letsencrypt.sh on VPS
      - ./certbot/conf:/etc/letsencrypt:ro
      - ./certbot/www:/var/www/certbot:ro
